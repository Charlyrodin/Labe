<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Runner - El Laberinto Tradicional</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        canvas {
            border: 2px solid #333;
            background-color: white;
            display: block;
        }
        .game-container {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #controls {
            margin-top: 20px;
        }
        #controls button {
            font-size: 16px;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .screen {
            display: none;
        }
        #register-screen, #login-screen {
            max-width: 400px;
            margin: 20px auto;
            text-align: left;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
        }
        #status {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="game-container" class="game-container">
        <h1>Maze Runner üèÉ</h1>
        
        <div id="menu-screen" class="screen" style="display: block;">
            <h2>Men√∫ Principal</h2>
            <div id="player-info" style="display: none;">
                <p>Bienvenido, <span id="username-display"></span>!</p>
            </div>
            <button onclick="showRegisterScreen()">Registrarse</button>
            <button onclick="showLoginScreen()">Iniciar Sesi√≥n</button>
            <button id="play-btn" style="display: none;" onclick="startGame()">Jugar</button>
        </div>

        <div id="register-screen" class="screen">
            <h2>Registro de Jugador</h2>
            <label for="reg-username">Usuario:</label>
            <input type="text" id="reg-username" placeholder="Elige un usuario">
            <label for="reg-password">Contrase√±a:</label>
            <input type="password" id="reg-password" placeholder="Crea una contrase√±a">
            <button onclick="registerUser()">Registrarse</button>
            <button onclick="showMenuScreen()">Volver</button>
            <p id="reg-status"></p>
        </div>

        <div id="login-screen" class="screen">
            <h2>Inicio de Sesi√≥n</h2>
            <label for="login-username">Usuario:</label>
            <input type="text" id="login-username" placeholder="Ingresa tu usuario">
            <label for="login-password">Contrase√±a:</label>
            <input type="password" id="login-password" placeholder="Ingresa tu contrase√±a">
            <button onclick="loginUser()">Iniciar Sesi√≥n</button>
            <button onclick="showMenuScreen()">Volver</button>
            <p id="login-status"></p>
        </div>

        <div id="game-screen" class="screen">
            <canvas id="mazeCanvas" width="500" height="500"></canvas>
            <div id="controls">
                <button id="up-btn">Arriba</button>
                <button id="left-btn">Izquierda</button>
                <button id="right-btn">Derecha</button>
                <button id="down-btn">Abajo</button>
            </div>
            <p id="game-status"></p>
        </div>

        <div id="end-screen" class="screen">
            <h2>¬°Felicidades! üéâ</h2>
            <p id="time-display"></p>
            <button onclick="showMenuScreen()">Jugar de Nuevo</button>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('mazeCanvas');
        const ctx = canvas.getContext('2d');
        const CELL_SIZE = 20;
        const MAZE_SIZE = 25;
        let maze;
        let playerX = 1;
        let playerY = 1;
        let startTime;

        let currentUser = null;

        // --- L√≥gica del juego ---

        function generateMaze() {
            // Algoritmo de generaci√≥n de laberintos (backtracking recursivo)
            const maze = Array.from({ length: MAZE_SIZE }, () => Array(MAZE_SIZE).fill(1));

            function carvePath(x, y) {
                maze[y][x] = 0;
                const directions = [[0, -2], [0, 2], [-2, 0], [2, 0]];
                directions.sort(() => Math.random() - 0.5);

                for (const [dx, dy] of directions) {
                    const nx = x + dx;
                    const ny = y + dy;

                    if (nx >= 0 && nx < MAZE_SIZE && ny >= 0 && ny < MAZE_SIZE && maze[ny][nx] === 1) {
                        maze[y + dy / 2][x + dx / 2] = 0;
                        carvePath(nx, ny);
                    }
                }
            }

            carvePath(1, 1);
            
            // Asegurar entrada y salida
            maze[1][0] = 0; // Entrada
            maze[MAZE_SIZE - 2][MAZE_SIZE - 1] = 0; // Salida
            
            return maze;
        }

        function drawMaze() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < MAZE_SIZE; y++) {
                for (let x = 0; x < MAZE_SIZE; x++) {
                    const isWall = maze[y][x] === 1;
                    ctx.fillStyle = isWall ? 'black' : 'white';
                    ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);

                    if (isWall) {
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }
            }

            // Dibujar al jugador
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(playerX * CELL_SIZE + CELL_SIZE / 2, playerY * CELL_SIZE + CELL_SIZE / 2, CELL_SIZE / 3, 0, Math.PI * 2);
            ctx.fill();

            // Dibujar la salida
            ctx.fillStyle = 'green';
            ctx.fillRect((MAZE_SIZE - 1) * CELL_SIZE - CELL_SIZE/2, (MAZE_SIZE - 2) * CELL_SIZE + CELL_SIZE/2, CELL_SIZE, CELL_SIZE);
        }

        function movePlayer(dx, dy) {
            const newX = playerX + dx;
            const newY = playerY + dy;

            if (newX >= 0 && newX < MAZE_SIZE && newY >= 0 && newY < MAZE_SIZE && maze[newY][newX] === 0) {
                playerX = newX;
                playerY = newY;
                drawMaze();
                checkWin();
            }
        }

        function checkWin() {
            if (playerX === MAZE_SIZE - 1 && playerY === MAZE_SIZE - 2) {
                const endTime = new Date();
                const timeTaken = (endTime - startTime) / 1000;
                document.getElementById('time-display').textContent = `Tu tiempo: ${timeTaken.toFixed(2)} segundos`;
                showScreen('end-screen');
                saveScore(timeTaken);
            }
        }

        function startGame() {
            maze = generateMaze();
            playerX = 1;
            playerY = 1;
            startTime = new Date();
            drawMaze();
            showScreen('game-screen');
        }

        // --- L√≥gica del registro y sesi√≥n ---

        function registerUser() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const status = document.getElementById('reg-status');

            if (localStorage.getItem(username)) {
                status.textContent = '‚ùå El usuario ya existe.';
            } else {
                localStorage.setItem(username, password);
                status.textContent = '‚úÖ Usuario registrado con √©xito. ¬°Ahora puedes iniciar sesi√≥n!';
            }
        }

        function loginUser() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const status = document.getElementById('login-status');

            if (localStorage.getItem(username) === password) {
                currentUser = username;
                document.getElementById('username-display').textContent = currentUser;
                document.getElementById('player-info').style.display = 'block';
                document.getElementById('play-btn').style.display = 'block';
                status.textContent = '‚úÖ Sesi√≥n iniciada.';
                showScreen('menu-screen');
            } else {
                status.textContent = '‚ùå Usuario o contrase√±a incorrectos.';
            }
        }

        function saveScore(time) {
            if (currentUser) {
                const scores = JSON.parse(localStorage.getItem('scores') || '{}');
                if (!scores[currentUser] || time < scores[currentUser]) {
                    scores[currentUser] = time;
                    localStorage.setItem('scores', JSON.stringify(scores));
                }
            }
        }

        // --- L√≥gica de la interfaz de usuario ---

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
        }

        function showMenuScreen() {
            showScreen('menu-screen');
        }

        function showRegisterScreen() {
            showScreen('register-screen');
        }

        function showLoginScreen() {
            showScreen('login-screen');
        }

        // Eventos de control
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('game-screen').style.display === 'block') {
                if (e.key === 'ArrowUp') movePlayer(0, -1);
                else if (e.key === 'ArrowDown') movePlayer(0, 1);
                else if (e.key === 'ArrowLeft') movePlayer(-1, 0);
                else if (e.key === 'ArrowRight') movePlayer(1, 0);
            }
        });

        document.getElementById('up-btn').addEventListener('click', () => movePlayer(0, -1));
        document.getElementById('down-btn').addEventListener('click', () => movePlayer(0, 1));
        document.getElementById('left-btn').addEventListener('click', () => movePlayer(-1, 0));
        document.getElementById('right-btn').addEventListener('click', () => movePlayer(1, 0));
    </script>
</body>
</html>